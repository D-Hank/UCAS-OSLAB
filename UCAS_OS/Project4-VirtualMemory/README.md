# Project4 - VirtualMemory

## Running Tips

在 Linux 命令行下使用 make all 命令构建所有任务，输入`sudo sh run_qemu.sh`启动 qemu，然后在qemu 中 loadboot，此时按下任意键使 bootblock 继续运行，开启地址翻译并引导至内核后，出现提示语句“Press any key to enter: ”，再按下任意键，出现 shell 命令行

## Test Sets

`fly`：小飞机测试，在命令行按下`exec fly`

`rw`：读写，测试缺页处理，将测试地址以命令行参数输入，如`exec rw 0x10800000 0xa0100000`，在这两个地址上写入随机数，然后再读出，即可测试这两个地址的缺页处理，当出现 Succcess! 字样时，测试成功

`swap`：页替换测试，在命令行输入`exec swap`，向 0x30000 ~ 0x5300000 上依次写入，最后再依次读出，检验读出值是否正确，最后出现 Success! 字样即成功，失败时陷入 assert

**Note**: 由于追加扇区会导致 make 构建速度变慢，我们在完成后续任务时先把追加扇区改回了65，如果需要运行该测试，需要在 Makefile 的 image 任务下，将 count 后面的 65 改大，此处我们建议为 68000。我们限制可用物理页框的数目为 0x5000，即 mm.h 中的 PH_PAGE 宏，交换区为 8192 页，起始为第 2048 个扇区，所以算上内核占用的 1000 多个扇区，SD 卡上应该有 68000 个扇区左右的空间。这一测试在板子上可能会比较慢，可以把中断次数设为 100，PH_PAGE 改为 0x80，测试地址为 0x30000 ~ 0x110000

这些数遍布了 0x5000 个页，加上 shell 和测试程序本身占用的页，划定的物理页框肯定是不够用的，需要向交换区写入

替换策略为物理页框轮流替换

`mailbox`：多线程消息收发，在命令行输入`exec mailbox a`，`exec mailbox b` 和 `exec mailbox c`，启动 3 个进程，它们分别创建各自的子线程，彼此收发消息

需要注意的是，如果用 `kill` 命令终止其中的某些进程来检验其正确性，接收到的字符数可能会少于发送的字符数，因为我们在杀死一个进程时，其附属的线程也会被一同杀死，于是信箱中的某些字符可能还未被完全接收

